---
- hosts: lamp            # name of a list of machines in inventory file
  remote_user: ubuntu
  become: true            # gives machines sudo capabilities

  tasks:
    - name: Install packages
      - apt:
          name: "{{ item }}"            # syntax for variable rather than a single value becauuse multiple packages will be installed.
          state: present                # Means you want the packages installed
          update_cache: true            # Updates apt cache before installing anything. (good practice)
        with_items:                     # with_items: property allows you to loop over a task with its required list of arguements
          - apache2
          - mysql-server
          - mysql-common
          - mysql-client
          - libapache2-mod-wsgi

    - name: Start services
      services:                         # service module 
        name: "{{ item }}"
        state: running
      with_items:
        - apache2
        - mysql

    - name: Enable modssl
      shell: a2enmod ssl                # shell module 

    - name: Enable default HTTPS site
      shell: a2ensite defualt-ssl

    - name: Restart Apache
      service:
        name: apache2
        state: restarted
    

    # Database Tasks 

    - name: Install python mysql lib
      apt:
        name: python-myswldb
        state: present 

    - name:
      myswl_user:
        name: appuser
        password: ijonkn
        priv: "*.*:ALL"
        state: present

    - name:
      myswl-_db:
        name: appdata
        state: present

    # app tasks
    - name: Install pip
      apt:
        name: python-pip
        state: present

    - name: Download app
      git:
        repo: url
        dest: /tmp/webapp/path
    
    - name: Install app requirements
      pip:
        requirements: /tmp/webapp/path

    # site install / configure 

  - name: Copy app to apache owner folder 
    shell: "rsync -av path"

  - name: Install mod-wsgi
    apt:
      name: libapache2-mod-wsgi
      state: present
  
  - name: Copy the apache configuration file
    copy:
      src: "apache.com"
      dest: /etc/apache2/sites-available/000-default.conf

  - name: Restart Apache
    service:
      name: apache2
      status: restarted




# A play book with one play and several tasks
# 